---
title: "Title of Your Report"
author: "Names of your Group Members"
date: "November 2, 2020"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
library(tidyverse)
library(survey)

# Loading in the cleaned survey Data
survey_data <- read_csv("X:/R studio proj/STA304-PS3/survey_data.csv")

# Loading in the cleaned census Data
census_data <- read_csv("X:/R studio proj/STA304-PS3/census_data.csv")

```

# Title of your Report

## Name(s) of Author(s) 
## November 2, 2020


# Model

Here we are interested in predicting the popular vote outcome of the 2020 American federal election (include citation). To do this we are employing a post-stratification technique. In the following sub-sections we will describe the model specifics and the post-stratification calculations.


## Model Specifics
We will be using a logistic regression model to model the proportion of voters who will vote for Donald Trump. A logistic model is suitable because the event of voting for Donald Trump is a Bernoulli random variable which means that it can only take on two possible values. We will be using birthplace, gender, race/ethnicity, household income, education, state, and age to model the probability of voting for Donald Trump. The logistic regression model we are using is:

\begin{align*}
    \ln \left(\frac{P_T}{1-P_T}\right) &= \beta_0+\beta_{\text{US}}x_{\text{US}} +\beta_{\text{male}}x_{\text{male}} \\
                                       &+\sum_{\substack{
            i\in \text{race}, \\
            i\neq \text{`american indian'}
            }}{\beta_ix_i} + \sum_{\substack{
            i\in \text{income}, \\
            i\neq \text{`100k to 125k'}
            }}{\beta_ix_i} + \sum_{\substack{
            i\in \text{education}, \\
            i\neq \text{`3rd grade'}  
            }}{\beta_ix_i} \\
                                       &+ \sum_{\substack{
            i\in \text{state}, \\
            i\neq \text{`AK'}
            }}{\beta_ix_i} + \sum_{\substack{
            i\in \text{age}, \\
            i\neq \text{`18 to 24'}
    }}{\beta_ix_i}
\end{align*}

Where $P_T$ represents the proportion of voters who will vote for Donald Trump. Similarly, $\beta_0$ represents the log-odds of voting for Donald Trump when the voter is born outside the US, is female and American Indian, has a household income between 100000 to 124999 dollars, below third grade education, living in Arkansas, and is between 18 and 24 years old.  The interpretation for the other $\beta_i$  are similar to one another. They represent the average change in log-odds when going from the default value of the variable to the $i$th value of the variable. The default values for all the variables were listed previously in the explanation of $\beta_0$. As a specific example, $\beta_{white}$ represents the average change in log-odds of voting for Donald Trump when going from American Indian observations to White observations. In this regression model, we used sampling weights which give the proportion of observations in the population that the observation represents. These sampling weights are automatically normalized according to the sample size as they have been provided for us in the raw survey dataset.

We will also use a similar logistic regression model to model the proportion of voters who will vote for Joe Biden. The explanatory variables are the exact same as the previous model, but the log-odds becomes
$$ ln(\frac{P_B}{1-P_B}) $$
Where $P_B$ represents the proportion of voters who will vote for Joe Biden. Interpretation of the parameters for the Joe Biden model is similar to the model for Donald Trump.

```{r, include=FALSE}

# Creating the Model
model.design <- svydesign(ids=~1, data = survey_data, weights = ~weight)

trump_model <- svyglm(vote_trump ~ foreign_born + gender + race_ethnicity + household_income + education + state + age_bin,
                      family = quasibinomial,
                      design = model.design)

# Model Results (to Report in Results section)
summary(trump_model)

biden_model <- svyglm(vote_biden ~ foreign_born + gender + race_ethnicity + household_income + education + state + age_bin,
                      family = quasibinomial,
                      design = model.design)

summary(biden_model)

```

## Post-Stratification 

In order to estimate the proportion of voters who will vote for Donald Trump and Joe Biden we will need to perform a post-stratification analysis. Here we create cells based off each of the explanatory variables in our model: birthplace, gender, race/ethnicity, household income, education, state, and age. We chose variables that we thought affected political leaning and were also in both both datasets. Using the models described in the previous sub-section we will estimate the proportion of voters who will vote for Donald Trump and Joe Biden in each cell. We will then weight each proportion estimate (within each cell) by the respective population size of that cell and sum those values and divide that by the entire population size. We will perform this twice, once to obtain the post-stratified proportion of voters who will vote for Donald Trump, and another to obtain the post-stratified proportion of voters who will vote for Joe Biden. In doing this post-stratification, we obtain a more accurate estimate of the proportion of voters who will vote for Donald Trump and Joe Biden. This is achieved by using the much larger census dataset to reduce the bias our smaller survey dataset may have.

```{r, include=FALSE}

# Perform the post-stratification calculations
census_data$logodds_estimate <- trump_model %>%
  predict(newdata = census_data)

census_data$estimate <- exp(census_data$logodds_estimate)/(1+exp(census_data$logodds_estimate))

trump_prop <- census_data %>%
  mutate(alp_predict_prop = estimate*n) %>%
  summarise(alp_predict = sum(alp_predict_prop)/sum(n))

trump_prop <- as.numeric(trump_prop)


census_data$logodds_estimate <- biden_model %>%
  predict(newdata = census_data)

census_data$estimate <- exp(census_data$logodds_estimate)/(1+exp(census_data$logodds_estimate))

biden_prop <- census_data %>%
  mutate(alp_predict_prop = estimate*n) %>%
  summarise(alp_predict = sum(alp_predict_prop)/sum(n))

biden_prop <- as.numeric(biden_prop)

```


# Results

Here you will include all results. This includes descriptive statistics, graphs, figures, tables, and model results. Please ensure that everything is well formatted and in a report style. You must also provide an explanation of the results in this section. 

Please ensure that everything is well labelled. So if you have multiple histograms and plots, calling them Figure 1, 2, 3, etc. and referencing them as Figure 1, Figure 2, etc. in your report will be expected. The reader should not get lost in a sea of information. Make sure to have the results be clean, well formatted and digestible.

We calculated that the proportion of voters who would vote for Donald Trump is 0.374. This was calculated using the logistic regression model we developed for predicting the log-odds of voters who would vote for Donald Trump, which took into account the voter's birthplace, gender, race/ethnicity, household income, education, state, and age. Similarly, we calculated that the proportion of voters who would vote for Joe Biden is 0.408.

# Discussion

Here you will summarize the previous sections and discuss conclusions drawn from the results. Make sure to elaborate and connect your analysis to the goal of the study.



## Weaknesses

Here we discuss weaknesses of the study, data, analysis, etc. You can also discuss areas for improvement.

## Next Steps

Here you discuss subsequent work to be done after this report. This can include next steps in terms of statistical analysis (perhaps there is a more efficient algorithm available, or perhaps there is a caveat in the data that would allow for some new technique). Future steps should also be specified in terms of the study setting (eg. including a follow-up survey on something, or a subsequent study that would complement the conclusions of your report).


# References

1. Tausanovitch, Chris and Lynn Vavreck. 2020. Democracy Fund + UCLA Nationscape, October 10-17, 2019 (version 20200814). Retrieved from https://www.voterstudygroup.org/publication/nationscape-data-set.

2. Steven Ruggles, Sarah Flood, Ronald Goeken, Josiah Grover, Erin Meyer, Jose Pacas and Matthew Sobek. IPUMS USA: Version 10.0 AMERICAN COMMUNITY SURVEY 2014-2018 5-YEAR SAMPLE. Minneapolis, MN: IPUMS, 2020. https://doi.org/10.18128/D010.V10.0

Make sure to cite R and every package.